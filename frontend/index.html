<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B站视频下载与AI总结工具</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>🎬 B站视频下载与AI总结工具</h1>

        <!-- 已下载内容 -->
        <div class="card">
            <h2>
                <span>📂 已下载内容</span>
                <button class="refresh-btn" id="refreshBtn">🔄 刷新</button>
            </h2>
            <div id="downloadList" class="download-list">
                <div class="empty-state">
                    <div class="empty-state-icon">📭</div>
                    <p>正在加载...</p>
                </div>
            </div>
        </div>

        <!-- 下载设置 -->
        <div class="card">
            <h2>📥 新建下载</h2>
            <div class="form-group">
                <label>BV号列表（每行一个，支持完整URL或纯BV号）</label>
                <textarea id="bvidInput" placeholder="BV1nPq2BoEf3&#10;https://www.bilibili.com/video/BV1xx411c7mD&#10;BV1es411B7qg"></textarea>
            </div>
            <div class="form-group">
                <label>下载类型</label>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" id="typeAudio" value="audio">
                        🎵 纯音频 (M4A)
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="typeVideoOnly" value="video_only">
                        🎥 纯视频 (无声)
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="typeMerged" value="merged" checked>
                        📹 合成视频 (音频+视频)
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="typeDanmaku" value="danmaku">
                        💬 弹幕 (XML)
                    </label>
                </div>
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" id="startDownloadBtn">🚀 开始下载</button>
                <button class="btn btn-secondary" id="clearTasksBtn">🗑️ 清空任务</button>
            </div>

            <div class="task-list" id="taskList"></div>
        </div>

        <!-- API设置 -->
        <div class="card">
            <h2>⚙️ API 设置</h2>
            <div class="api-settings">
                <div class="form-group">
                    <label>Base URL</label>
                    <input type="text" id="baseUrl" value="https://api.openai.com/v1" placeholder="https://api.openai.com/v1">
                </div>
                <div class="form-group">
                    <label>API Key</label>
                    <input type="password" id="apiKey" placeholder="sk-xxx...">
                </div>
                <div class="form-group">
                    <label>模型</label>
                    <input type="text" id="modelName" value="gpt-3.5-turbo" placeholder="gpt-3.5-turbo">
                </div>
            </div>
            <div class="form-group">
                <label>总结 Prompt</label>
                <textarea id="summaryPrompt" rows="3">请对以下视频内容进行总结，提取主要观点和关键信息，用中文回答：</textarea>
            </div>
        </div>

        <!-- 转录与总结 -->
        <div class="card">
            <h2>📝 转录与总结</h2>
            <div class="form-group">
                <label>选择要处理的BV号（可从上方已下载列表点击选择）</label>
                <input type="text" id="processBvid" placeholder="输入BV号，如：BV1nPq2BoEf3">
            </div>

            <!-- 转写格式选择 -->
            <div class="format-options">
                <div class="format-options-title">📄 输出格式（可多选）</div>
                <div class="format-checkboxes">
                    <label class="format-checkbox">
                        <input type="checkbox" id="formatTxt" value="txt" checked disabled>
                        <span>纯文本 (.txt)</span>
                        <span class="format-desc">默认</span>
                    </label>
                    <label class="format-checkbox">
                        <input type="checkbox" id="formatTimestamped" value="timestamped">
                        <span>时间戳文本 (_timestamped.txt)</span>
                    </label>
                    <label class="format-checkbox">
                        <input type="checkbox" id="formatSrt" value="srt">
                        <span>SRT字幕 (.srt)</span>
                    </label>
                    <label class="format-checkbox">
                        <input type="checkbox" id="formatVtt" value="vtt">
                        <span>VTT字幕 (.vtt)</span>
                    </label>
                    <label class="format-checkbox">
                        <input type="checkbox" id="formatJson" value="json">
                        <span>JSON数据 (.json)</span>
                    </label>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" id="transcribeBtn">
                    🎤 音频转文本 (Whisper)
                </button>
                <button class="btn btn-success" id="summarizeBtn">
                    🤖 AI总结
                </button>
            </div>

            <!-- 总结选项 -->
            <div class="summary-options">
                <label>
                    <input type="checkbox" id="includeTimestamps">
                    <span>📍 总结时包含时间戳信息</span>
                </label>
                <span class="summary-hint">（启用后AI可能会在总结中引用具体时间点）</span>
            </div>

            <p class="info-text">💡 首次转写需要加载模型，约需1-2分钟。纯文本(.txt)为默认输出，其他格式可选。</p>

            <!-- 转写进度 -->
            <div id="transcribeProgress" class="transcribe-progress hidden">
                <h4>🎤 转写进度</h4>
                <div class="progress-bar">
                    <div class="progress-fill" id="transcribeProgressBar" style="width: 0%"></div>
                </div>
                <p class="task-message" id="transcribeMessage">准备中...</p>
            </div>

            <!-- 转录结果 -->
            <div id="transcriptResult" class="result-box hidden">
                <h3>
                    <span>📄 转录结果</span>
                    <div class="format-tabs" id="formatTabs">
                        <button class="format-tab active" data-format="plain">纯文本</button>
                        <button class="format-tab" data-format="timestamped">时间戳文本</button>
                        <button class="format-tab" data-format="segments">分段视图</button>
                        <button class="format-tab" data-format="srt">SRT字幕</button>
                    </div>
                </h3>

                <!-- 统计信息 -->
                <div class="transcript-stats" id="transcriptStats">
                    <div class="stat-item">
                        <span class="stat-label">时长:</span>
                        <span class="stat-value" id="statDuration">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">片段数:</span>
                        <span class="stat-value" id="statSegments">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">字数:</span>
                        <span class="stat-value" id="statChars">-</span>
                    </div>
                    <div class="stat-item">
                        <button class="copy-btn" id="copyBtn">📋 复制</button>
                    </div>
                </div>

                <div class="result-content">
                    <div id="viewPlain">
                        <pre id="transcriptText"></pre>
                    </div>
                    <div id="viewTimestamped" class="hidden">
                        <pre id="transcriptTimestamped"></pre>
                    </div>
                    <div id="viewSegments" class="hidden">
                        <div id="transcriptSegments"></div>
                    </div>
                    <div id="viewSrt" class="hidden">
                        <pre id="transcriptSrt"></pre>
                    </div>
                </div>
            </div>

            <!-- AI总结结果 -->
            <div id="summaryResult" class="result-box hidden">
                <h3>🤖 AI总结</h3>
                <div class="result-content">
                    <pre id="summaryText"></pre>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
